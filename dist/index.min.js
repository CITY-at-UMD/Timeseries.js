!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("data-forge"),require("dayjs"),require("simple-statistics")):"function"==typeof define&&define.amd?define(["data-forge","dayjs","simple-statistics"],e):(t=t||self).Timeseries=e(t.dataForge,t.dayjs,t.simpleStatistics)}(this,function(t,e,r){function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}e=e&&e.hasOwnProperty("default")?e.default:e;var o=function(t,e){return t===e||t!=t&&e!=e},a=function(t,e){for(var r=t.length;r--;)if(o(t[r][0],e))return r;return-1},i=Array.prototype.splice;function u(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}u.prototype.clear=function(){this.__data__=[],this.size=0},u.prototype.delete=function(t){var e=this.__data__,r=a(e,t);return!(r<0||(r==e.length-1?e.pop():i.call(e,r,1),--this.size,0))},u.prototype.get=function(t){var e=this.__data__,r=a(e,t);return r<0?void 0:e[r][1]},u.prototype.has=function(t){return a(this.__data__,t)>-1},u.prototype.set=function(t,e){var r=this.__data__,n=a(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var c=u,f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t,e){return t(e={exports:{}},e.exports),e.exports}var l,d="object"==typeof f&&f&&f.Object===Object&&f,p="object"==typeof self&&self&&self.Object===Object&&self,h=d||p||Function("return this")(),v=h.Symbol,y=Object.prototype,b=y.hasOwnProperty,_=y.toString,g=v?v.toStringTag:void 0,j=Object.prototype.toString,w=v?v.toStringTag:void 0,m=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":w&&w in Object(t)?function(t){var e=b.call(t,g),r=t[g];try{t[g]=void 0;var n=!0}catch(t){}var o=_.call(t);return n&&(e?t[g]=r:delete t[g]),o}(t):function(t){return j.call(t)}(t)},O=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},A=function(t){if(!O(t))return!1;var e=m(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},x=h["__core-js_shared__"],S=(l=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"",z=Function.prototype.toString,D=function(t){if(null!=t){try{return z.call(t)}catch(t){}try{return t+""}catch(t){}}return""},E=/^\[object .+?Constructor\]$/,P=Function.prototype,F=Object.prototype,k=RegExp("^"+P.toString.call(F.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T=function(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!O(t)||(e=t,S&&S in e))&&(A(t)?k:E).test(D(t));var e}(r)?r:void 0},M=T(h,"Map"),N=T(Object,"create"),V=Object.prototype.hasOwnProperty,B=Object.prototype.hasOwnProperty;function q(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}q.prototype.clear=function(){this.__data__=N?N(null):{},this.size=0},q.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},q.prototype.get=function(t){var e=this.__data__;if(N){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return V.call(e,t)?e[t]:void 0},q.prototype.has=function(t){var e=this.__data__;return N?void 0!==e[t]:B.call(e,t)},q.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=N&&void 0===e?"__lodash_hash_undefined__":e,this};var I=q,$=function(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map};function R(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}R.prototype.clear=function(){this.size=0,this.__data__={hash:new I,map:new(M||c),string:new I}},R.prototype.delete=function(t){var e=$(this,t).delete(t);return this.size-=e?1:0,e},R.prototype.get=function(t){return $(this,t).get(t)},R.prototype.has=function(t){return $(this,t).has(t)},R.prototype.set=function(t,e){var r=$(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var U=R;function L(t){var e=this.__data__=new c(t);this.size=e.size}L.prototype.clear=function(){this.__data__=new c,this.size=0},L.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},L.prototype.get=function(t){return this.__data__.get(t)},L.prototype.has=function(t){return this.__data__.has(t)},L.prototype.set=function(t,e){var r=this.__data__;if(r instanceof c){var n=r.__data__;if(!M||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new U(n)}return r.set(t,e),this.size=r.size,this};var C=L;function G(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new U;++e<r;)this.add(t[e])}G.prototype.add=G.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},G.prototype.has=function(t){return this.__data__.has(t)};var W=G,Z=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},Q=function(t,e,r,n,o,a){var i=1&r,u=t.length,c=e.length;if(u!=c&&!(i&&c>u))return!1;var f=a.get(t);if(f&&a.get(e))return f==e;var s=-1,l=!0,d=2&r?new W:void 0;for(a.set(t,e),a.set(e,t);++s<u;){var p=t[s],h=e[s];if(n)var v=i?n(h,p,s,e,t,a):n(p,h,s,t,e,a);if(void 0!==v){if(v)continue;l=!1;break}if(d){if(!Z(e,function(t,e){if(!d.has(e)&&(p===t||o(p,t,r,n,a)))return d.push(e)})){l=!1;break}}else if(p!==h&&!o(p,h,r,n,a)){l=!1;break}}return a.delete(t),a.delete(e),l},H=h.Uint8Array,J=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r},K=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r},X=v?v.prototype:void 0,Y=X?X.valueOf:void 0,tt=Array.isArray,et=Object.prototype.propertyIsEnumerable,rt=Object.getOwnPropertySymbols,nt=rt?function(t){return null==t?[]:(t=Object(t),function(e,r){for(var n=-1,o=null==e?0:e.length,a=0,i=[];++n<o;){var u=e[n];et.call(t,u)&&(i[a++]=u)}return i}(rt(t)))}:function(){return[]},ot=function(t){return null!=t&&"object"==typeof t},at=function(t){return ot(t)&&"[object Arguments]"==m(t)},it=Object.prototype,ut=it.hasOwnProperty,ct=it.propertyIsEnumerable,ft=at(function(){return arguments}())?at:function(t){return ot(t)&&ut.call(t,"callee")&&!ct.call(t,"callee")},st=function(){return!1},lt=s(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?h.Buffer:void 0;t.exports=(o?o.isBuffer:void 0)||st}),dt=/^(?:0|[1-9]\d*)$/,pt=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&dt.test(t))&&t>-1&&t%1==0&&t<e},ht=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},vt={};vt["[object Float32Array]"]=vt["[object Float64Array]"]=vt["[object Int8Array]"]=vt["[object Int16Array]"]=vt["[object Int32Array]"]=vt["[object Uint8Array]"]=vt["[object Uint8ClampedArray]"]=vt["[object Uint16Array]"]=vt["[object Uint32Array]"]=!0,vt["[object Arguments]"]=vt["[object Array]"]=vt["[object ArrayBuffer]"]=vt["[object Boolean]"]=vt["[object DataView]"]=vt["[object Date]"]=vt["[object Error]"]=vt["[object Function]"]=vt["[object Map]"]=vt["[object Number]"]=vt["[object Object]"]=vt["[object RegExp]"]=vt["[object Set]"]=vt["[object String]"]=vt["[object WeakMap]"]=!1;var yt,bt=s(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&d.process,a=function(){try{return n&&n.require&&n.require("util").types||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}),_t=bt&&bt.isTypedArray,gt=_t?(yt=_t,function(t){return yt(t)}):function(t){return ot(t)&&ht(t.length)&&!!vt[m(t)]},jt=Object.prototype.hasOwnProperty,wt=Object.prototype,mt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Ot=Object.prototype.hasOwnProperty,At=function(t){return function(t,e,r){var n=function(t){return null!=(e=t)&&ht(e.length)&&!A(e)?function(t,e){var r=tt(t),n=!r&&ft(t),o=!r&&!n&&lt(t),a=!r&&!n&&!o&&gt(t),i=r||n||o||a,u=i?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],c=u.length;for(var f in t)!jt.call(t,f)||i&&("length"==f||o&&("offset"==f||"parent"==f)||a&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||pt(f,c))||u.push(f);return u}(t):function(t){if((e=t)!==("function"==typeof(r=e&&e.constructor)&&r.prototype||wt))return mt(t);var e,r,n=[];for(var o in Object(t))Ot.call(t,o)&&"constructor"!=o&&n.push(o);return n}(t);var e}(t);return tt(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,0,nt)},xt=Object.prototype.hasOwnProperty,St=T(h,"DataView"),zt=T(h,"Promise"),Dt=T(h,"Set"),Et=T(h,"WeakMap"),Pt=D(St),Ft=D(M),kt=D(zt),Tt=D(Dt),Mt=D(Et),Nt=m;(St&&"[object DataView]"!=Nt(new St(new ArrayBuffer(1)))||M&&"[object Map]"!=Nt(new M)||zt&&"[object Promise]"!=Nt(zt.resolve())||Dt&&"[object Set]"!=Nt(new Dt)||Et&&"[object WeakMap]"!=Nt(new Et))&&(Nt=function(t){var e=m(t),r="[object Object]"==e?t.constructor:void 0,n=r?D(r):"";if(n)switch(n){case Pt:return"[object DataView]";case Ft:return"[object Map]";case kt:return"[object Promise]";case Tt:return"[object Set]";case Mt:return"[object WeakMap]"}return e});var Vt=Nt,Bt=Object.prototype.hasOwnProperty,qt=function(t){var r=t[0],n=t[1],o=void 0===n?1:n;return function(t,n){var a=t[0];return Math.floor(e(n[0]).diff(a,r,!0)/o)>0}},It=function(t,e,r){var n,o,a=e.startValue,i=e.endValue,u=e.entryIndex,c=e.numEntries,f=r.overrideValue,s=r.dateFunction,l=r.date,d=r.flag;if(!(-1===["pad","interpolate","average"].indexOf(t)||a&&i&&u&&c))throw new Error("fill Type not supported without date, index and entries");return"pad"===t?(n=a.value,f&&(n=f),o=["fill",t]):"interpolate"===t?(n=a.value+(u+1)*((i.value-a.value)/c),f&&(n=f),o=["fill",t]):"average"===t?(n=(a.value+i.value)/c,f&&(n=f/c),o=["fill",t]):"dateFunction"===t&&s?(n=s(l),o=["fill",t]):"value"===t&&!isNaN(f)&&f?(n=f,o=["fill",t]):(n=null,o=["fill"]),d&&(o=d),{value:n,flag:o}},$t=function(t,r,n){var o=r[0],a=r[1],i=void 0===n?{}:n,u=i.overrideValue,c=i.dateFunction,f=i.flag;return function(r,n){for(var i=r[0],s=Math.floor(e(n[0]).diff(i,o)/a)-1,l=r[1],d=n[1],p=[],h=0;h<s;++h){var v=It(t,{startValue:l,endValue:d,entryIndex:h,numEntries:s},{overrideValue:u,dateFunction:c,flag:f}),y=e(i).add((h+1)*a,o).toDate(),b=[y.valueOf(),Object.assign({},v,{date:y})];p.push(b)}return p}};return function(a){var i,u;function c(e){void 0===e&&(e=[]),(e instanceof t.DataFrame||e instanceof c)&&(e=e.toArray());var r={values:e=e.sort(function(t,e){return new Date(t.date).valueOf()-new Date(e.date).valueOf()}),index:e.map(function(t){return new Date(t.date).valueOf()}),considerAllRows:!0};return a.call(this,r)||this}u=a,(i=c).prototype=Object.create(u.prototype),i.prototype.constructor=i,i.__proto__=u;var f,s=c.prototype;return s.dateRange=function(t,r){var n=e(this.first().date),o=e(this.last().date);return r&&(n=n.startOf(r),o=o.endOf(r)),o.diff(n,t)},s.at=function(t){return a.prototype.at.call(this,new Date(t).valueOf())},s.calculateThresholds=function(t){var e=void 0===t?{}:t,r=e.k,n=e.filterZeros,o=void 0===n||n,a=this.where(function(t){return null==t.flag||Array.isArray(t.flag)&&0===t.flag.length}).where(function(t){return!isNaN(t.value)&&null!==t.value}).getSeries("value");return o&&(a=a.where(function(t){return 0!==t})),r||(r=a.count()<1e3?Math.floor(.15*a.count()):Math.min.apply(Math,[1e3,Math.floor(.02*a.count())])),a.count()<5?{}:{esd:rosnerTest(a.toArray(),r).thresholds,box:boxPlotTest(a.toArray()).thresholds,modz:modifiedZScoreTest(a.toArray()).thresholds}},s.removeOutliers=function(t){var e=void 0===t?{}:t,r=e.lowerThreshold,n=e.upperThreshold;if(r>n)throw new Error("thresholds invalid");var o=function(t,e,r){return t<e||t>r};return this.generateSeries({raw:function(t){return o(t.value,r,n)?t.value:null},flag:function(t){return o(t.value,r,n)?["outlier"]:null}}).transformSeries({value:function(t){return o(t,r,n)?null:t}})},s.reset=function(){return this.withSeries({value:function(t){return t.raw&&!isNaN(t.raw)?t.raw:t.value}}).dropSeries(["flag","raw"])},s.group=function(t,r){if(-1===["hour","day","month","year"].indexOf(t))throw new Error("interval type not supported");return this.groupBy(function(r){return e(r.date).startOf(t)})},s.resample=function(t,r){var n=t[0],a=t[1],i=void 0===a?1:a;if(-1===["hour","day","month","year"].indexOf(n))throw new Error("interval type not supported");var u=this.interval;if(function t(e,r,n,a,i){return e===r||(null==e||null==r||!ot(e)&&!ot(r)?e!=e&&r!=r:function(t,e,r,n,a,i){var u=tt(t),c=tt(e),f=u?"[object Array]":Vt(t),s=c?"[object Array]":Vt(e),l="[object Object]"==(f="[object Arguments]"==f?"[object Object]":f),d="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),p=f==s;if(p&&lt(t)){if(!lt(e))return!1;u=!0,l=!1}if(p&&!l)return i||(i=new C),u||gt(t)?Q(t,e,r,n,a,i):function(t,e,r,n,a,i,u){switch(f){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new H(t),new H(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var c=J;case"[object Set]":if(c||(c=K),t.size!=e.size&&!(1&n))return!1;var s=u.get(t);if(s)return s==e;n|=2,u.set(t,e);var l=Q(c(t),c(e),n,a,i,u);return u.delete(t),l;case"[object Symbol]":if(Y)return Y.call(t)==Y.call(e)}return!1}(t,e,0,r,n,a,i);if(!(1&r)){var h=l&&Bt.call(t,"__wrapped__"),v=d&&Bt.call(e,"__wrapped__");if(h||v){var y=h?t.value():t,b=v?e.value():e;return i||(i=new C),a(y,b,r,n,i)}}return!!p&&(i||(i=new C),function(t,e,r,n,o,a){var i=1&r,u=At(t),c=u.length;if(c!=At(e).length&&!i)return!1;for(var f=c;f--;){var s=u[f];if(!(i?s in e:xt.call(e,s)))return!1}var l=a.get(t);if(l&&a.get(e))return l==e;var d=!0;a.set(t,e),a.set(e,t);for(var p=i;++f<c;){var h=t[s=u[f]],v=e[s];if(n)var y=i?n(v,h,s,e,t,a):n(h,v,s,t,e,a);if(!(void 0===y?h===v||o(h,v,r,n,a):y)){d=!1;break}p||(p="constructor"==s)}if(d&&!p){var b=t.constructor,_=e.constructor;b!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _)&&(d=!1)}return a.delete(t),a.delete(e),d}(t,e,r,n,a,i))}(e,r,n,a,t,i))}(u,[n,i]))return this;var c=e(0);return e(0).add(u[1],u[0]).diff(c)<e(0).add(i,n).diff(c)?this.downsample([n,i],r):this.upsample([n,i],r)},s.upsample=function(t,e){var r=t[0],n=t[1];return void 0===e&&(e="avg"),this.fillGaps(qt([r,n]),$t(e,[r,n]))},s.downsample=function(t,r){var o=t[0],a=t[1];if(void 0===r&&(r="sum"),-1===["hour","day","month","year"].indexOf(o))throw new Error("interval type not supported");if(-1===["sum","avg","median"].indexOf(r))throw new Error("aggregation type not suppported, only:");var i=function(t){return e(t.date).startOf(o)};return a&&(i=function(t){return e(t.date).startOf(o).add(a,o)}),this.groupBy(i).select(function(t){return n({date:e(t.first().date).startOf(o).toDate()},function(t){for(var e=-1,r=null==t?0:t.length,n={};++e<r;){var o=t[e];n[o[0]]=o[1]}return n}(t.getColumnNames().filter(function(t){return"date"!==t}).map(function(e){var n;switch(r){case"median":n=t.deflate(function(t){return t[e]}).median();break;case"avg":n=t.deflate(function(t){return t[e]}).average();break;default:n=t.deflate(function(t){return t[e]}).sum()}return[e,n]})))}).inflate().withIndex(function(t){return t.date.valueOf()})},s.calculateStatistics=function(t){var e=void 0===t?{}:t,n=e.filterZeros,o=void 0!==n&&n,a=e.filterNegative,i=void 0===a||a,u=this.deflate(function(t){return t[columnName]}).where(function(t){return!isNaN(t)});i&&(u=u.where(function(t){return t>=0})),o&&(u=u.where(function(t){return 0!==t}));var c=u.median(),f=u.average(),s=u.count(),l=u.std(),d=u.min(),p=u.max(),h=r.medianAbsoluteDeviation(u.toArray()),v=r.quantile(u.toArray(),.25),y=r.quantile(u.toArray(),.75);return{median:c,mean:f,count:s,std:l,min:d,max:p,mad:h,q1:v,q3:y,iqr:y-v}},s.dataQuality=function(){return this.count(),this.getSeries("flag").where(function(t){return null==t||Array.isArray(t)&&0===t.length}).count(),this.getSeries("flag").where(function(t){return Array.isArray(t)}).where(function(t){return-1!==t.indexOf("missing")}).count(),this.getSeries("flag").where(function(t){return Array.isArray(t)}).where(function(t){return-1!==t.indexOf("outlier")}).count(),this.getSeries("flag").where(function(t){return Array.isArray(t)}).where(function(t){return-1!==t.indexOf("zeroFill")}).count(),{}},s.populate=function(t,e){var r;switch(void 0===e&&(e="avg"),e){case"fill":r=t;break;default:r=t/this.getIndex().count()}return this.generateSeries({value:function(t){return r}})},s.fill=function(t,e){return t&&Array.isArray(t)||(t=this.interval),new c(this.fillGaps(qt(t),$t(e,t)))},c.blank=function(t,r,o){var a=o[0],i=o[1],u=void 0===i?1:i;if(["minute","hour","day","month","year"].indexOf(a)<0)throw console.error(interval),new Error("interval type not supported");var f=new c([{date:new Date(t)},{date:new Date(r)}]).fillGaps(qt([a,u]),function(t,r){var o=t[0],a=t[1];return function(t,r){for(var i=t[0],u=Math.floor(e(r[0]).diff(i,o)/a)-1,c=[],f=0;f<u;++f){var s=e(i).add((f+1)*a,o).toDate();c.push([s.valueOf(),n({date:s,value:null},void 0)])}return c}}([a,u])).between(t,r);return new c(f)},c.aggregate=function(e){return Array.isArray(e)||(e=[e]),e=e.map(function(t){return new c(t)}),new c(t.DataFrame.concat(e).groupBy(function(t){return t.date}).select(function(t){var e={date:t.first().date};return t.getColumnNames().filter(function(t){return"date"!==t}).forEach(function(r){return e[r]=t.deflate(function(t){return t[r]}).sum()}),e}).inflate().toArray())},(f=[{key:"interval",get:function(){var t,r,n,o=this.first().date,a=this.last().date;return t=this.between(o,a).getIndex().window(2).select(function(t){return t.last()-t.first()}).detectValues().orderBy(function(t){return t.Frequency}).orderBy(function(t){return t.Value}).last().Value,r=e(),(n=e().add(t)).diff(r,"year",!0)>=1?["year",n.diff(r,"year")]:n.diff(r,"month",!0)>=1?["month",n.diff(r,"month")]:n.diff(r,"day",!0)>=1?["day",n.diff(r,"day")]:n.diff(r,"hour",!0)>=1?["hour",n.diff(r,"hour")]:["minute",n.diff(r,"minute")]}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(c.prototype,f),c}(t.DataFrame)});
//# sourceMappingURL=index.min.js.map
