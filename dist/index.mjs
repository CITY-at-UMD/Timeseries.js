function e(){return(e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var r=require("data-forge").DataFrame,t=require("dayjs"),n=require("./lib/Timeseries.interval").msToInterval,a=require("lodash/isEqual"),i=require("lodash/fromPairs"),o=require("./lib/Timeseries.fill"),u=o.gapExists,l=o.gapFill,s=o.gapFillBlank,f=require("simple-statistics"),c=f.medianAbsoluteDeviation,d=f.quantile;module.exports=function(o){var f,h;function v(e){void 0===e&&(e=[]),(e instanceof r||e instanceof v)&&(e=e.toArray());var t={values:e=e.sort(function(e,r){return new Date(e.date).valueOf()-new Date(r.date).valueOf()}),index:e.map(function(e){return new Date(e.date).valueOf()}),considerAllRows:!0};return o.call(this,t)||this}h=o,(f=v).prototype=Object.create(h.prototype),f.prototype.constructor=f,f.__proto__=h;var p,g=v.prototype;return g.dateRange=function(e,r){var n=t(this.first().date),a=t(this.last().date);return r&&(n=n.startOf(r),a=a.endOf(r)),a.diff(n,e)},g.at=function(e){return o.prototype.at.call(this,new Date(e).valueOf())},g.calculateThresholds=function(e){var r=void 0===e?{}:e,t=r.k,n=r.filterZeros,a=void 0===n||n,i=this.where(function(e){return null==e.flag||Array.isArray(e.flag)&&0===e.flag.length}).where(function(e){return!isNaN(e.value)&&null!==e.value}).getSeries("value");return a&&(i=i.where(function(e){return 0!==e})),t||(t=i.count()<1e3?Math.floor(.15*i.count()):Math.min.apply(Math,[1e3,Math.floor(.02*i.count())])),i.count()<5?{}:{esd:rosnerTest(i.toArray(),t).thresholds,box:boxPlotTest(i.toArray()).thresholds,modz:modifiedZScoreTest(i.toArray()).thresholds}},g.removeOutliers=function(e){var r=void 0===e?{}:e,t=r.lowerThreshold,n=r.upperThreshold;if(t>n)throw new Error("thresholds invalid");var a=function(e,r,t){return e<r||e>t};return this.generateSeries({raw:function(e){return a(e.value,t,n)?e.value:null},flag:function(e){return a(e.value,t,n)?["outlier"]:null}}).transformSeries({value:function(e){return a(e,t,n)?null:e}})},g.reset=function(){return this.withSeries({value:function(e){return e.raw&&!isNaN(e.raw)?e.raw:e.value}}).dropSeries(["flag","raw"])},g.group=function(e,r){if(-1===["hour","day","month","year"].indexOf(e))throw new Error("interval type not supported");return this.groupBy(function(r){return t(r.date).startOf(e)})},g.resample=function(e,r){var n=e[0],i=e[1],o=void 0===i?1:i;if(-1===["hour","day","month","year"].indexOf(n))throw new Error("interval type not supported");var u=this.interval;if(a(u,[n,o]))return this;var l=t(0),s=t(0).add(u[1],u[0]).diff(l),f=t(0).add(o,n).diff(l);return console.log(s,f),s<f?(console.log("downsample"),this.downsample([n,o],r)):(console.log("upsample"),this.upsample([n,o],r))},g.upsample=function(e,r){var t=e[0],n=e[1];return void 0===r&&(r="avg"),this.fillGaps(u([t,n]),l(r,[t,n]))},g.downsample=function(r,n){var a=r[0],o=r[1];if(void 0===n&&(n="sum"),-1===["hour","day","month","year"].indexOf(a))throw new Error("interval type not supported");if(-1===["sum","avg","median"].indexOf(n))throw new Error("aggregation type not suppported, only:");var u=function(e){return t(e.date).startOf(a)};return o&&(u=function(e){return t(e.date).startOf(a).add(o,a)}),this.groupBy(u).select(function(r){return e({date:t(r.first().date).startOf(a).toDate()},i(r.getColumnNames().filter(function(e){return"date"!==e}).map(function(e){var t;switch(n){case"median":t=r.deflate(function(r){return r[e]}).median();break;case"avg":t=r.deflate(function(r){return r[e]}).average();break;default:t=r.deflate(function(r){return r[e]}).sum()}return[e,t]})))}).inflate().withIndex(function(e){return e.date.valueOf()})},g.calculateStatistics=function(e){var r=void 0===e?{}:e,t=r.filterZeros,n=void 0!==t&&t,a=r.filterNegative,i=void 0===a||a,o=this.deflate(function(e){return e[columnName]}).where(function(e){return!isNaN(e)});i&&(o=o.where(function(e){return e>=0})),n&&(o=o.where(function(e){return 0!==e}));var u=o.median(),l=o.average(),s=o.count(),f=o.std(),h=o.min(),v=o.max(),p=c(o.toArray()),g=d(o.toArray(),.25),w=d(o.toArray(),.75);return{median:u,mean:l,count:s,std:f,min:h,max:v,mad:p,q1:g,q3:w,iqr:w-g}},g.dataQuality=function(){return this.count(),this.getSeries("flag").where(function(e){return null==e||Array.isArray(e)&&0===e.length}).count(),this.getSeries("flag").where(function(e){return Array.isArray(e)}).where(function(e){return-1!==e.indexOf("missing")}).count(),this.getSeries("flag").where(function(e){return Array.isArray(e)}).where(function(e){return-1!==e.indexOf("outlier")}).count(),this.getSeries("flag").where(function(e){return Array.isArray(e)}).where(function(e){return-1!==e.indexOf("zeroFill")}).count(),{}},g.populate=function(e,r){var t;switch(void 0===r&&(r="avg"),r){case"fill":t=e;break;default:t=e/this.getIndex().count()}return this.generateSeries({value:function(e){return t}})},v.blank=function(e,t,n){var a=n[0],i=n[1],o=void 0===i?1:i;if(["minute","hour","day","month","year"].indexOf(a)<0)throw console.error(interval),new Error("interval type not supported");var l=new v([{date:new Date(e)},{date:new Date(t)}]).fillGaps(u([a,o]),s([a,o])).between(e,t);return console.log(l instanceof v),console.log(l instanceof r),new v(l)},v.aggregate=function(e){return Array.isArray(e)||(e=[e]),e=e.map(function(e){return new v(e)}),new v(r.concat(e).groupBy(function(e){return e.date}).select(function(e){var r={date:e.first().date};return e.getColumnNames().filter(function(e){return"date"!==e}).forEach(function(t){return r[t]=e.deflate(function(e){return e[t]}).sum()}),r}).inflate().toArray())},(p=[{key:"interval",get:function(){var e=this.first().date,r=this.last().date,t=this.between(e,r).getIndex().window(2).select(function(e){return e.last()-e.first()}).detectValues().orderBy(function(e){return e.Frequency}).orderBy(function(e){return e.Value}).last().Value;return n(t)}}])&&function(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(v.prototype,p),v}(r);
//# sourceMappingURL=index.mjs.map
